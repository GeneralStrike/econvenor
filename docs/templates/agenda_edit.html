{% extends "app_base.html" %}
{% load setclass %}

{% block content %}


  <div class="row">
 
    <div class="col-sm-3 sidebar">
      <ul class="nav nav-sidebar">
        <li><a href="#meeting_details">Meeting details</a></li>
      </ul>
      <ul class="nav nav-sidebar">
        {% for item in items %}
          <li>
          <div>
            <a href="#id_{{ item.item_no}}-heading">{{ item.item_no}}. {{ item.heading }}</a>
            <div class="pull-right">
              <form action="" method="POST">
                {% csrf_token %}
                {% ifnotequal item.item_no 1 %}
                  <button type="submit" class="btn btn-default btn-xs" name="up_button" value="move_up_{{ item.item_no}}">
                    <span class="glyphicon glyphicon-chevron-up"></button>
                {% endifnotequal %}
                {% ifnotequal item.item_no item_count %}
                  <button type="submit" class="btn btn-default btn-xs" name="down_button" value="move_down_{{ item.item_no}}">
                  <span class="glyphicon glyphicon-chevron-down"></button>
                {% endifnotequal %}
                <button type="submit" class="btn btn-default btn-xs" name="delete_button" value="delete_item_{{ item.item_no}}">
                  <span class="glyphicon glyphicon-remove"></button>
              </form>
            </div><!-- ./pull-right -->
          </div>
          </li>
        {% endfor %}
      </ul>
      <ul class="nav nav-sidebar">
        <li><a href="#tasks">Appendix 1 - Tasks</a></li>
      </ul>
      <ul class="nav nav-sidebar">
        <li><button type="button" class="btn btn-primary" onClick="saveform()" name="add_item_button" data-toggle="button">Save all</button></li>
      </ul>
      <form action="" method="POST">
        {% csrf_token %}
        <ul class="nav nav-sidebar"> 
          <li><button type="submit" class="btn btn-primary" name="add_item_button" value="add_item" data-toggle="button">Add item</button></li>
          <li><a href={% url 'minutes-edit' meeting_id %}><button type="button" class="btn btn-primary" data-toggle="button">Create minutes from this agenda</button></a></li>
          <li><a href={% url 'agenda-print' meeting_id %}><button type="button" class="btn btn-primary" data-toggle="button">Create a PDF of this agenda</button></a></li>
          <li><a href={% url 'agenda-distribute' meeting_id %}><button type="button" class="btn btn-primary" data-toggle="button">Distribute this agenda</button></a></li>
        </ul>
      </form>
    </div><!-- /.col-sm-3 -->


    <div class="col-sm-7 col-sm-offset-4 main">
      
      <h1>{{ page_heading }}</h1>
      

      <div class="well" id="meeting_details">
      <h1><small>Meeting details</small></h1>
      {% ifequal focus 'meeting' %}
      <form action="" method="POST">
        {% csrf_token %}
        {% for hidden in existing_data_forms.hidden_fields %}
          <div class="form-group">
            {{ hidden }}
          </div>
        {% endfor %}	
        {% for field in existing_data_forms.visible_fields %}
          <div>
            {{ field.label_tag }}
            {% ifequal field.label "Date" %}
              <br>
              {{ field }}
            {% else %}
              {{ field|setclass:"form-control" }}
            {% endifequal %}
          </div>
          <br>
        {% endfor %}
        <button type="submit" class="btn btn-primary" name="save_meeting_details_button" value="save_meeting_details" data-toggle="button">Save meeting details</button>
        <button type="submit" class="btn btn-default" name="cancel_meeting_details_button" value="cancel_meeting_details" data-toggle="button">Discard changes</button>
        <button type="submit" class="btn btn-danger" name="delete_meeting_button" value="delete_meeting" data-toggle="button">Delete meeting</button>
      </form>
      {% else %}
      
      <div class="panel panel-primary">
			
		<table class="table">
			<thead>
				<tr>
					<th>{{ meeting.description }} of {{ account.group_name }}</th>
					<th></th>
				</tr>
			</thead>
			<tbody> 
				<tr>
					<td><strong>Date</strong></td>
					<td>{{ meeting.date }}</td>
				</tr>
				<tr>
					<td><strong>Start time</strong></td>
					<td>{{ meeting.start_time }}</td>
				</tr>
				<tr>
					<td><strong>End time</strong></td>
					<td>{{ meeting_end_time }}</td>
				</tr>
				<tr>
					<td><strong>Scheduled duration</strong></td>
					<td>{{ meeting_duration }}</td>
				</tr>
				<tr>
					<td><strong>Location</strong></td>
					<td>{{ meeting.location|linebreaks }}</td>
				</tr>
				<tr>
					<td><strong>Notes</strong></td>
					<td>{{ meeting.notes|linebreaks }}</td>
				</tr>
			</tbody>
		</table>
	</div>
   	<form action="" method="POST">
   		{% csrf_token %}
		<button type="submit" class="btn btn-default" name="edit_meeting_details_button" value="edit_meeting_details" data-toggle="button">Edit meeting details</button>
	</form>
      
      {% endifequal %}
      </div>


      <form class="autosave" action="" method="POST">
        {% csrf_token %}
        {% for item in item_formlist %}
          <div class="panel panel-primary">
            <div class="panel-heading">
              {{ item.heading|setclass:"form-control" }}
            </div>
          <div class="panel-body">
            {{ item.time_limit.label_tag }}{{ item.time_limit|setclass:"form-control" }}		
            {{ item.explainer.label_tag }}{{ item.explainer|setclass:"form-control" }}
            {{ item.background.label_tag }}{{ item.background|setclass:"form-control" }}    
          </div>
          {% for hidden in item.hidden_fields %}
            <div class="form-group">
              {{ hidden }}
            </div>
          {% endfor %}
          </div>
        {% endfor %}
      </form>
      
     <div class="well" id="tasks">
	<h1><small>Appendix 1 - Tasks</small></h1>
	<h2><small>Tasks outstanding</small></h2>
	<div class="panel panel-primary">
		<table class="table">
			<thead>
				<tr>
					{% for heading in task_list_headings %}
						<th>{{ heading }}</th>
					{% endfor%}
				</tr>
			</thead>
			<tbody> 
				{% for task in incomplete_task_list %}
					<tr>
						<td>{{ task.description }}</td>
						<td>{{ task.participant }}</td>
						<td>{{ task.deadline }}</td>
					</tr>
				{% empty %}
					<tr>
						<td>None</td>
					</tr>
				{% endfor%}
			</tbody>
		</table>
	</div>
	{# List of tasks completed since last meeting #}
	<h2><small>Tasks completed since last meeting</small></h2>
	<div class="panel panel-primary">
		<table class="table">
			<thead>
				<tr>
					{% for heading in task_list_headings %}
						<th>{{ heading }}</th>
					{% endfor%}
				</tr>
			</thead>
			<tbody> 
				{% for task in completed_task_list %}
					<tr>
						<td>{{ task.description }}</td>
						<td>{{ task.participant }}</td>
						<td>{{ task.deadline }}</td>
					</tr>
				{% empty %}
				<tr>
					<td>None</td>
				</tr>
				
				{% endfor%}
			</tbody>
		</table>
	</div>
	</div>
	
    <div class="spacer">
    </div>      

		
    </div><!-- /.col-sm-7 -->
  </div><!-- ./row>


{% endblock %}


